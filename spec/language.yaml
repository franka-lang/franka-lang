# Franka Language Specification
# Version: 1.0.0
# A self-documenting language specification for the Franka Programming Language

metadata:
  name: Franka
  version: "1.0.0"
  description: "The language of collaboration - A pure functional programming language designed for clear communication and collaboration"
  file_extension: ".yaml"
  syntax_format: "yaml"
  comment_style:
    single_line: "#"
    multi_line:
      start: "###"
      end: "###"

syntax:
  description: "Franka is a pure functional language. Programs are written in YAML format and evaluate to a single value."
  
  program_structure:
    description: "A Franka program is a YAML document with logic that evaluates to a value"
    root_keys:
      - name: "program"
        description: "Root key containing program metadata"
        required: true
      - name: "input"
        description: "Input declarations with type definitions and optional default values"
        required: false
      - name: "output"
        description: "Output declarations with type definitions (no default values)"
        required: false
      - name: "logic"
        description: "Logic to evaluate - can be a value, operation, or let binding"
        required: true
    
    input_structure:
      description: "Input declarations specify typed variables with optional default values"
      format: |
        input:
          variable_name:
            type: string|number|boolean
            default: value  # optional
      properties:
        - name: "type"
          description: "Data type of the input variable"
          required: true
          values: ["string", "number", "boolean"]
        - name: "default"
          description: "Default value for the input variable (must match specified type)"
          required: false
      example: |
        input:
          username:
            type: string
            default: "guest"
          age:
            type: number
            default: 18
          is_active:
            type: boolean
            default: true
    
    output_structure:
      description: "Output declarations specify the type of values a program produces. Supports single unnamed output or multiple named outputs."
      formats:
        - name: "single_unnamed"
          description: "Single output without a name mapping"
          format: |
            output:
              type: string|number|boolean
          example: |
            output:
              type: string
        - name: "multiple_named"
          description: "Multiple named outputs"
          format: |
            output:
              output_name:
                type: string|number|boolean
          example: |
            output:
              result:
                type: string
              is_valid:
                type: boolean
              count:
                type: number
      properties:
        - name: "type"
          description: "Data type of the output (string, number, or boolean)"
          required: true
          values: ["string", "number", "boolean"]
      notes:
        - "Output declarations do not support default values"
        - "Output declarations are for documentation purposes and do not affect program execution"
        - "Use single unnamed format when there is only one output"
        - "Use multiple named format when documenting multiple outputs"

  operations:
    input_output:
      - name: "get"
        description: "Get an input variable value by name"
        parameters:
          - name: "variable_name"
            type: "string"
            description: "Name of the input variable to retrieve"
        example: |
          get: username
        notes:
          - "Use this syntax to reference input variables and let bindings"
      
      - name: "set"
        description: "Set one or more named output values. Can be used at any node of an if/else tree."
        parameters:
          - name: "outputs"
            type: "mapping"
            description: "Output names as keys, values as logic to evaluate"
        example: |
          set:
            result: "Success"
            count: 42
        advanced_example: |
          # Set outputs at non-leaf level using sequences
          if: condition1
          then:
            - set:
                foo: 1
            - if: condition2
              then:
                set:
                  bar: "A"
              else:
                set:
                  bar: "B"
          else:
            set:
              foo: 2
              bar: "C"
        notes:
          - "Used with multiple named outputs defined in the output section"
          - "Can set multiple outputs in a single set operation"
          - "When set is used, the program returns an object with output names and values"
          - "Can be placed in if/then/else branches to set outputs conditionally"
          - "Use sequences (arrays) to set some outputs at a non-leaf level and others at leaf levels"
          - "Output values set at a parent level are preserved and merged with outputs set at child levels"
    
    let:
      - name: "let"
        description: "Define local variable bindings with lexical scoping. Supports flat syntax where 'let' and 'in' are at the same indentation level."
        syntax_variants:
          - name: "nested"
            description: "Original nested syntax (still supported for backward compatibility)"
            example: |
              let:
                x: 5
                y: 10
                in:
                  get: x
          - name: "flat"
            description: "Flat syntax with let and in at the same indentation level (recommended)"
            example: |
              let:
                x: 5
                y: 10
              in:
                get: x
        parameters:
          - name: "bindings"
            type: "mapping"
            description: "Variable names as keys, values as logic. Each binding can reference earlier bindings."
          - name: "in"
            type: "logic"
            description: "Logic to evaluate with the bindings in scope"
        example: |
          let:
            x: 5
            y: 10
            sum:
              concat:
                - get: x
                - " + "
                - get: y
          in:
            get: sum
    
    string:
      - name: "concat"
        description: "Concatenate strings"
        parameters:
          - name: "values"
            type: "list"
            description: "List of string values or variable references to concatenate"
        example: |
          concat:
            - "Hello, "
            - get: name
      
      - name: "length"
        description: "Get string length"
        parameters:
          - name: "value"
            type: "string"
            description: "String value or variable reference"
        example: |
          length:
            get: text
      
      - name: "substring"
        description: "Extract substring"
        parameters:
          - name: "value"
            type: "string"
            description: "String value or variable reference"
          - name: "start"
            type: "number"
            description: "Starting index"
          - name: "end"
            type: "number"
            description: "Ending index (optional)"
        example: |
          substring:
            value:
              get: text
            start: 0
            end: 5
      
      - name: "uppercase"
        description: "Convert string to uppercase"
        parameters:
          - name: "value"
            type: "string"
            description: "String value or variable reference"
        example: |
          uppercase:
            get: text
      
      - name: "lowercase"
        description: "Convert string to lowercase"
        parameters:
          - name: "value"
            type: "string"
            description: "String value or variable reference"
        example: |
          lowercase:
            get: text
    
    boolean:
      - name: "and"
        description: "Logical AND operation"
        parameters:
          - name: "values"
            type: "list"
            description: "List of boolean values or variable references"
        example: |
          and:
            - true
            - get: condition
      
      - name: "or"
        description: "Logical OR operation"
        parameters:
          - name: "values"
            type: "list"
            description: "List of boolean values or variable references"
        example: |
          or:
            - false
            - get: condition
      
      - name: "not"
        description: "Logical NOT operation"
        parameters:
          - name: "value"
            type: "boolean"
            description: "Boolean value or variable reference"
        example: |
          not:
            get: condition
      
      - name: "equals"
        description: "Equality comparison"
        parameters:
          - name: "left"
            type: "any"
            description: "Left operand"
          - name: "right"
            type: "any"
            description: "Right operand"
        example: |
          equals:
            left:
              get: value1
            right:
              get: value2
    
    control:
      - name: "if"
        description: "Conditional logic that returns a value. Supports both nested and flat syntax, as well as chaining."
        syntax_variants:
          - name: "nested"
            description: "Original nested syntax (still supported for backward compatibility)"
            example: |
              if:
                condition:
                  equals:
                    left:
                      get: name
                    right: "Alice"
                then: "Hello Alice!"
                else: "Hello stranger!"
          - name: "flat"
            description: "Flat syntax with if, then, else on the same indentation level"
            example: |
              if:
                equals:
                  left:
                    get: name
                  right: "Alice"
              then: "Hello Alice!"
              else: "Hello stranger!"
          - name: "chaining"
            description: "Chain multiple if-then conditions in a list with a final else"
            example: |
              - if:
                  equals:
                    left:
                      get: score
                    right: 100
                then: "Perfect!"
              - if:
                  equals:
                    left:
                      get: score
                    right: 90
                then: "Excellent!"
              - else: "Good effort!"
        parameters:
          - name: "if / condition"
            type: "any"
            description: "Condition to evaluate (flat syntax uses 'if', nested syntax uses 'condition')"
          - name: "then"
            type: "logic"
            description: "Logic to evaluate if condition is true"
          - name: "else"
            type: "logic"
            description: "Logic to evaluate if condition is false (optional)"
    
    chaining:
      - name: "operation chaining"
        description: "Chain operations together where each operation receives the result of the previous one, similar to pipe operators (|>) in functional languages like Elm."
        syntax: "A list of operations where each receives the output of the previous operation"
        format: |
          - operation1: value
          - operation2
          - operation3: parameter
        parameters:
          - name: "operations"
            type: "list"
            description: "List of operations to chain. Each operation can be a simple string (operation name) or an object with operation name and parameters"
        example: |
          - get: greeting
          - uppercase
          - concat: " world!"
        notes:
          - "The first operation is typically 'get' to retrieve a value"
          - "Subsequent operations can be written as simple names (e.g., 'uppercase') for operations that don't need parameters"
          - "Operations with parameters (e.g., 'concat: \" world!\"') will receive the piped value as the first input"
          - "Chain must have at least 2 elements to be recognized as a chain"
          - "Supports all string operations (uppercase, lowercase, length, substring, concat)"
          - "Supports boolean operations (not, and, or, equals)"
          - "Can be used within let bindings or as the main logic"
        supported_operations:
          - name: "uppercase"
            description: "Convert piped value to uppercase"
          - name: "lowercase"
            description: "Convert piped value to lowercase"
          - name: "length"
            description: "Get length of piped string value"
          - name: "substring"
            description: "Extract substring from piped value"
            parameters: "start and optional end"
          - name: "concat"
            description: "Concatenate piped value with additional values"
            parameters: "string value or array of values to append"
          - name: "not"
            description: "Negate piped boolean value"
          - name: "and"
            description: "AND piped value with additional values"
            parameters: "boolean value or array of values"
          - name: "or"
            description: "OR piped value with additional values"
            parameters: "boolean value or array of values"
          - name: "equals"
            description: "Compare piped value with another value"
            parameters: "value to compare with"

  data_types:
    primitives:
      - name: "String"
        description: "Text values"
        examples: ["\"hello\"", "\"world\"", "\"\""]
      
      - name: "Boolean"
        description: "True or false values"
        examples: ["true", "false"]
    
    sequences:
      - name: "Sequence"
        description: "A list of operations to execute in order (YAML array)"
        examples: 
          - "- set: { foo: 1 }\n- if: condition\n  then: { set: { bar: 'A' } }"
        notes:
          - "Sequences are used to execute multiple operations in order"
          - "Each operation in a sequence is evaluated sequentially"
          - "If multiple set operations occur in a sequence, outputs are merged"
          - "Commonly used in if/then/else branches to set outputs at different levels"
          - "If a sequence is an if-chain (all elements have if/then or else keys), it's treated as a chained conditional instead"

semantics:
  scoping:
    type: "lexical"
    description: "Let bindings create lexical scopes. Variables are scoped to the 'in' logic of their let block."
  
  purity:
    paradigm: "pure functional"
    description: "No side effects. Programs evaluate to values rather than producing output."
  
  type_system:
    paradigm: "dynamic"
    description: "Runtime type checking with YAML structure validation"
  
  evaluation:
    strategy: "eager"
    description: "Logic is evaluated eagerly. Let bindings are evaluated sequentially, allowing later bindings to reference earlier ones."
  
  variables:
    reference_syntax:
      - syntax: "get: variable_name"
        description: "Method to reference input variables using get operation"
        example: "get: username"
    notes:
      - "Use the 'get' operation to reference input variables and let bindings"
      - "Variables can be input variables (with or without defaults) or let bindings"
  
  outputs:
    single_output:
      description: "When no 'set' operation is used, the program returns a single value from the logic"
      example: "logic: \"Hello, World!\""
    multiple_outputs:
      description: "When 'set' operation is used, the program returns an object with named output values"
      syntax: "set: { outputname1: value1, outputname2: value2 }"
      notes:
        - "Named outputs must be declared in the output section"
        - "Set operations can be placed at any node of an if/else tree"
        - "Multiple outputs can be set in a single set operation"
        - "When outputs are set, the return value is an object with output names as keys"

tooling:
  cli:
    description: "Command-line interface for the Franka language"
    commands:
      - name: "run"
        description: "Execute a Franka program"
        usage: "franka run <file>"
      
      - name: "check"
        description: "Check syntax without execution"
        usage: "franka check <file>"
      
      - name: "repl"
        description: "Start interactive REPL"
        usage: "franka repl"
      
      - name: "version"
        description: "Display version information"
        usage: "franka version"
  
  mcp:
    description: "Model Context Protocol server for AI integration"
    capabilities:
      - "code_completion"
      - "syntax_checking"
      - "documentation_lookup"
  
  web:
    description: "Web-based development environment"
    features:
      - "online_editor"
      - "syntax_highlighting"
      - "interactive_tutorial"

examples:
  - name: "Hello World"
    description: "Basic program that returns a greeting"
    code: |
      program:
        name: "Hello World"
        description: "A simple greeting program"
      
      logic: "Hello, Franka!"
  
  - name: "String Operations"
    description: "Demonstrate string manipulation with let bindings"
    code: |
      program:
        name: "String Operations"
      
      input:
        greeting:
          type: string
          default: "Hello"
        name:
          type: string
          default: "World"
      
      logic:
        let:
          message:
            concat:
              - get: greeting
              - ", "
              - get: name
              - "!"
          upper_message:
            uppercase:
              get: message
        in:
          get: upper_message
  
  - name: "Boolean Logic"
    description: "Demonstrate boolean operations"
    code: |
      program:
        name: "Boolean Logic"
      
      input:
        is_valid:
          type: boolean
          default: true
        is_admin:
          type: boolean
          default: false
      
      logic:
        let:
          can_access:
            and:
              - get: is_valid
              - get: is_admin
          result:
            if:
              get: can_access
            then: "Access granted"
            else: "Access denied"
        in:
          get: result
  
  - name: "Conditional String Processing"
    description: "Combine boolean and string operations"
    code: |
      program:
        name: "Conditional String Processing"
      
      input:
        username:
          type: string
          default: "alice"
        expected:
          type: string
          default: "alice"
      
      logic:
        let:
          is_match:
            equals:
              left:
                get: username
              right:
                get: expected
          greeting:
            if:
              get: is_match
            then:
              concat:
                - "Welcome, "
                - get: username
                - "!"
            else: "Unknown user"
        in:
          get: greeting

  - name: "If-Then Chaining"
    description: "Chain multiple conditional logic"
    code: |
      program:
        name: "If-Then Chaining"
      
      input:
        score:
          type: number
          default: 85
      
      logic:
        let:
          grade:
            - if:
                equals:
                  left:
                    get: score
                  right: 100
              then: "A+ Perfect!"
            - if:
                equals:
                  left:
                    get: score
                  right: 85
              then: "B+ Great!"
            - else: "Keep Trying!"
        in:
          get: grade
  
  - name: "Single Output"
    description: "Program with a single unnamed output declaration"
    code: |
      program:
        name: "Single Output"
        description: "Program with a single unnamed output"
      
      input:
        greeting:
          type: string
          default: "Hello"
        name:
          type: string
          default: "World"
      
      output:
        type: string
      
      logic:
        let:
          message:
            concat:
              - get: greeting
              - ", "
              - get: name
              - "!"
        in:
          get: message
  
  - name: "Multiple Outputs"
    description: "Program with multiple named output declarations"
    code: |
      program:
        name: "Multiple Outputs"
        description: "Program with multiple named outputs"
      
      input:
        value:
          type: number
          default: 42
      
      output:
        result:
          type: string
        is_positive:
          type: boolean
        doubled:
          type: number
      
      logic:
        let:
          doubled_value:
            concat:
              - "Value doubled: "
              - get: value
        in:
          get: doubled_value
  
  - name: "Get and Set Operations"
    description: "Demonstrate the new get/set syntax for input/output handling"
    code: |
      program:
        name: "Get and Set Operations"
        description: "Using get for inputs and set for outputs"
      
      input:
        username:
          type: string
          default: "alice"
        age:
          type: number
          default: 25
      
      output:
        greeting:
          type: string
        category:
          type: string
      
      logic:
        let:
          user:
            get: username
          user_age:
            get: age
        in:
          set:
            greeting:
              concat:
                - "Hello, "
                - get: username
                - "!"
            category:
              if:
                equals:
                  left:
                    get: age
                  right: 25
              then: "Young Adult"
              else: "Other"
  
  - name: "Conditional Outputs"
    description: "Setting different outputs based on conditions using get/set"
    code: |
      program:
        name: "Conditional Outputs"
        description: "Set outputs conditionally at different if/else branches"
      
      input:
        score:
          type: number
          default: 85
      
      output:
        grade:
          type: string
        passed:
          type: boolean
      
      logic:
        - if:
            equals:
              left:
                get: score
              right: 100
          then:
            set:
              grade: "A+"
              passed: true
        - if:
            equals:
              left:
                get: score
              right: 85
          then:
            set:
              grade: "B+"
              passed: true
        - else:
            set:
              grade: "F"
              passed: false
  
  - name: "Nested Output Setting"
    description: "Set outputs at non-leaf levels of an if/else tree"
    code: |
      program:
        name: "Nested Output Setting"
        description: "Demonstrates setting outputs at any branch level"
      
      input:
        cond1:
          type: boolean
          default: true
        cond2:
          type: boolean
          default: true
      
      output:
        foo:
          type: number
        bar:
          type: string
      
      logic:
        if:
          get: cond1
        then:
          # Use a sequence to set foo at non-leaf level
          - set:
              foo: 1
          # Then continue with nested if/else for bar
          - if:
              get: cond2
            then:
              set:
                bar: "A"
            else:
              set:
                bar: "B"
        else:
          # Set both outputs at leaf level
          set:
            foo: 2
            bar: "C"

  - name: "Operation Chaining"
    description: "Demonstrate operation chaining with pipe-like syntax"
    code: |
      program:
        name: "Operation Chaining"
        description: "Chain operations like Elm's pipe operator (|>)"
      
      input:
        greeting:
          type: string
          default: "hello"
        name:
          type: string
          default: "world"
      
      logic:
        let:
          # Simple chain: get -> uppercase -> concat
          message:
            - get: greeting
            - uppercase
            - concat:
                - ", "
                - get: name
            - concat: "!"
        in:
          get: message
